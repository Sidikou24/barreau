{% extends "base.html" %}
{% block title %}Actes d’avocats{% endblock %}

{% block content %}
<div class="container">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1>Actes d’avocats</h1>
        <button class="btn btn-primary" onclick="document.getElementById('nouvelActeModal').style.display='flex'">Nouvel acte</button>
    </div>

    <form method="get" action="" style="margin-bottom: 1rem; display:flex; gap:8px;">
        <input class="input" type="text" name="q" placeholder="Rechercher par numéro d’acte ou nom d’avocat" value="{{ q }}" />
        <button class="btn btn-outline" type="submit">Rechercher</button>
    </form>

    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
        <div class="card" style="padding:1rem;">
            <div>Total des actes</div>
            <div style="font-size:1.5rem; font-weight:700;">{{ total }}</div>
        </div>
        <div class="card" style="padding:1rem;">
            <div>En attente</div>
            <div style="font-size:1.5rem; font-weight:700;">{{ en_attente }}</div>
        </div>
        <div class="card" style="padding:1rem;">
            <div>Archivés</div>
            <div style="font-size:1.5rem; font-weight:700;">{{ archives }}</div>
        </div>
    </div>

    <div class="card" style="padding:1rem;">
        <table style="width:100%; border-collapse: collapse;">
            <thead>
                <tr style="text-align:left; border-bottom: 1px solid #eee;">
                    <th style="padding:0.5rem;">Numéro d’acte</th>
                    <th style="padding:0.5rem;">Nom de l’avocat</th>
                    <th style="padding:0.5rem;">Date de dépôt</th>
                    <th style="padding:0.5rem;">Statut</th>
                    <th style="padding:0.5rem;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for acte in actes %}
                <tr style="border-bottom: 1px solid #f3f4f6;">
                    <td style="padding:0.5rem;">{{ acte.numero_acte }}</td>
                    <td style="padding:0.5rem;">{{ acte.avocat.nom }}</td>
                    <td style="padding:0.5rem;">{{ acte.date_depot.strftime('%d/%m/%Y') }}</td>
                    <td style="padding:0.5rem;">
                        {% if acte.statut == 'archive' %}
                            <span class="badge badge-secondary">Archivé</span>
                        {% elif acte.statut == 'traite' %}
                            <span class="badge badge-green">Validé</span>
                        {% else %}
                            <span class="badge badge-red">En cours de validation</span>
                        {% endif %}
                    </td>
                    <td style="padding:0.5rem; display:flex; gap:6px;">
                        <a class="btn btn-outline" href="{{ url_for('actes_avocat.view', acte_id=acte.acte_id) }}">Voir</a>
                        <a class="btn btn-outline" href="{{ url_for('actes_avocat.edit', acte_id=acte.acte_id) }}">Modifier</a>
                        <form method="post" action="{{ url_for('actes_avocat.delete', acte_id=acte.acte_id) }}" onsubmit="return confirm('Supprimer cet acte ?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-destructive">Supprimer</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" style="padding:0.75rem; text-align:center; color:#666;">Aucun acte trouvé</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Nouvel acte -->
<div id="nouvelActeModal" class="modal" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
    <div class="modal-content">
        <h3 class="text-lg leading-6 font-medium mb-2">Enregistrer un nouvel acte</h3>
        <form method="post" action="{{ url_for('actes_avocat.create') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div style="display:flex; flex-direction:column; gap:10px;">
                <div>
                    <label>Numéro d’acte</label>
                    <input class="input" type="text" name="numero_acte" placeholder="ACT-2024-XXX (laisser vide pour générer)" />
                </div>
                <div>
                    <label>Avocat</label>
                    <select class="select" name="avocat_id" required>
                        <option value="">-- Sélectionner un avocat --</option>
                        {% for a in avocats %}
                        <option value="{{ a.avocat_id }}">{{ a.nom }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Document scanné (PDF/Image)</label>
                    <input class="input" type="file" name="document" accept=".pdf,.png,.jpg,.jpeg" />
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:1rem;">
                <button type="button" class="btn btn-outline" onclick="document.getElementById('nouvelActeModal').style.display='none'">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer l’acte</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}